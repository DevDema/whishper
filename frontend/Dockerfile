FROM node:alpine as build

ARG PUBLIC_API_HOST
ARG PUBLIC_TRANSLATION_API_HOST
ARG PUBLIC_INTERNAL_API_HOST

ENV PUBLIC_API_HOST=$PUBLIC_API_HOST
ENV PUBLIC_TRANSLATION_API_HOST=$PUBLIC_TRANSLATION_API_HOST
ENV PUBLIC_INTERNAL_API_HOST=$PUBLIC_INTERNAL_API_HOST

WORKDIR /app
COPY . .
RUN yarn
ENV BODY_SIZE_LIMIT=0
RUN yarn build
RUN ls -al

FROM node:alpine as production

ARG PUBLIC_API_HOST
ARG PUBLIC_TRANSLATION_API_HOST
ARG PUBLIC_INTERNAL_API_HOST

ENV PUBLIC_API_HOST=$PUBLIC_API_HOST
ENV PUBLIC_TRANSLATION_API_HOST=$PUBLIC_TRANSLATION_API_HOST
ENV PUBLIC_INTERNAL_API_HOST=$PUBLIC_INTERNAL_API_HOST
ENV BODY_SIZE_LIMIT=0

WORKDIR /app
COPY --from=build /app/package.json ./
COPY --from=build /app/build/ ./
RUN yarn --production
EXPOSE 3000
CMD [ "node",  "index.js"]